(function(){window.Dash={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";return Dash.Parse=Parse,Dash.Parse.initialize("D7VKvOCpa2Pnt8lr3dvynhVQxoDW6AgiXVsyQuB1","Rs7IHkHHTTqv7O51TKwhNHMZnvQyvqrqUg5jn1pg"),new Dash.Routers.Routes}},$(function(){"use strict";return Dash.init()})}).call(this),this.JST=this.JST||{},this.JST["app/scripts/templates/Dashboard.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="container">\n\n  {{#user}}\n  <div class="row">\n    <div class="col-md-6">\n      <img src="{{company_logo.url}}" style="width:100px;">\n    </div>\n    <div class="col-md-6 text-right">\n      <p><strong>Email:</strong> {{email}}</p> \n      <p><strong>Profile:</strong> {{description}}</p>\n      <p><strong>Address:</strong> {{street_number}} {{street_name}} {{city}} {{province}} {{postal_code}}</p>\n      <p><u><a href="#logout">Logout</a></u></p>\n    </div>\n  </div>\n  {{/user}}\n\n  <hr>\n\n  <div class="row">\n    <div class="col-md-3">\n      <p>123 People Nearby</p>\n      <a class="btn btn-info" href="#newDeal">+ Add A New Deal</a>\n    </div>\n  </div>\n\n  <hr>\n\n  {{#deals}}\n    <div class="row">\n      <div class="col-md-4">\n        <img src="{{mainImage.url}}"/>\n      </div>\n      <div class="col-md-5">\n        <h1>Deal Details</h1>\n        <h2>{{heading}}</h2>\n        <p>Created <span class="time">{{createdAt}}</span></p>\n\n        <div class="viwedBy" data-created-at="{{createdAt}}">\n          287\n        </div>\n\n        <!-- <p>Address : <span class="address">{{address}}</span></p> -->\n      </div>\n    </div>\n    <div style="height:5vh;"></div>\n  {{/deals}}\n</div>';return __p},this.JST["app/scripts/templates/Landing.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="landing">\n    <div class="login-form">\n        <h1>Welcome to Airbrowz</h1>\n        <p>Merchant login</p>\n          <input id="email" type="email" placeholder="Email" />\n          <input id="password" type="password" placeholder="Password" />\n          <button class="btn-wire-green" id="login">Submit</button>\n          <p>\n            <a href="#signup" style="color:white;">Create a new account</a>\n          </p>\n    </div>\n</div>';return __p},this.JST["app/scripts/templates/NewDeal.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="container">\n\n  <a class="btn btn-default" href="#dashboard">\n    Cancel\n  </a>\n\n  <hr>\n\n  <form class="form-horizontal">\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Heading</label>\n      <div class="col-sm-10">\n        <input id=\'heading\' type="text" class="form-control" placeholder="Deal Title">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Image</label>\n      <div class="col-sm-10">\n        <input type="file" id="dealImage">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Youtube Link</label>\n      <div class="col-sm-10">\n        <input id="youtube" type="text" class="form-control" placeholder="Optional">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Category</label>\n      <div class="col-sm-10">\n        <select id="category">\n          <option>-- Select --</option>\n          <option value="0">Fashion</option>\n          <option value="1">Food</option>\n          <option value="2">Electronics</option>\n          <option value="3">Entertainment</option>\n          <option value="4">Health/Fitness</option>\n          <option value="5">Service</option>\n          <option value="6">Lifestyle</option>\n          <option value="7">Furniture</option>\n          <option value="8">Misc</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="col-md-2 col-md-offset-10 text-right">\n        <button class="btn btn-info btn-lg" id="create">Create</button>\n      </div>\n    </div>\n\n  </form>\n</div>\n';return __p},this.JST["app/scripts/templates/Signup.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div style="height:10vh;"></div>\n<div class="container" style="height:100vh;">\n\n  <form class="form-horizontal">\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Company Name</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control" id="company_name" placeholder="Company Name">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Company Logo</label>\n      <div class="col-sm-10">\n        <input type="file" class="form-control" id="company_logo" placeholder="Company Name">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Email</label>\n      <div class="col-sm-10">\n        <input type="email" class="form-control" id="email" placeholder="Email">\n      </div>\n    </div>\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Password</label>\n      <div class="col-sm-10">\n        <input type="password" class="form-control" id="password" placeholder="Password">\n      </div>\n    </div>\n    \n    <div class="form-group">\n      <label class="col-sm-2 control-label">Description</label>\n      <div class="col-sm-10">\n        <textarea id="description" rows="3" style="width:100%;"></textarea>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Address</label>\n\n      <div class="col-sm-10">\n        <div class="row">\n          <div class="col-sm-2">\n            <input id="street_number" type="text" class="form-control" placeholder="Street #" />\n          </div>\n          <div class="col-sm-8">\n            <input id="street_name" type="text" class="form-control" placeholder="Street Name" />\n          </div>\n          <div class="col-sm-2">\n            <input id="postal_code" type="text" class="form-control" placeholder="Postal Code" />\n          </div>\n        </div>\n        <div class="row">\n          <div class="col-sm-8">\n            <input id="city" type="text" class="form-control" placeholder="City" />\n          </div>\n          <div class="col-sm-4">\n            <input id="province" type="text" class="form-control" placeholder="Province" />\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="col-sm-1 col-sm-offset-11">\n        <button id="register" type="submit" class="btn btn-info">Register</button>\n      </div>\n    </div>\n\n  </form>\n</div>\n\n- capacity to upload profile of business including Tags\n- upload deals and information\n- upload photos and video for deals\n- set distance trigger for information to be sent';return __p},function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Models.User=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.url="",d.prototype.initialize=function(){},d.prototype.defaults={},d.prototype.validate=function(a,b){},d.prototype.parse=function(a,b){return a},d}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.Landing=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/Landing.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.className="",d.prototype.events={"click #login":"login"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){return this.$el.html(this.template())},d.prototype.login=function(a){var b,c;return a.preventDefault(),console.log("login"),b=$("#email").val(),c=$("#password").val(),Parse.User.logIn(b,c,{success:function(a){window.location.href="#dashboard"},error:function(a,b){alert("Wrong email/password. Please try again")}})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Routers.Routes=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.routes={"":"landing",signup:"signup",dashboard:"dashboard",newDeal:"newDeal",logout:"logout"},d.prototype.initialize=function(){return Backbone.history.start()},d.prototype.landing=function(){return console.log("landing"),new Dash.Views.Landing({el:$("#main")[0]})},d.prototype.dashboard=function(){return console.log("dashboard"),Parse.User.current()?new Dash.Views.Dashboard({el:$("#main")[0]}):(console.log("need to authenticate"),window.location.href="/")},d.prototype.signup=function(){return console.log("signup"),new Dash.Views.Signup({el:$("#main")[0]})},d.prototype.newDeal=function(){return console.log("new deal"),new Dash.Views.NewDeal({el:$("#main")[0]})},d.prototype.logout=function(){return Parse.User.logOut(),window.location.href="/"},d}(Backbone.Router)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.Signup=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/Signup.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.className="",d.prototype.events={"click #register":"signup"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){return this.$el.html(this.template())},d.prototype.signup=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return a.preventDefault(),c=$("#company_name").val().trim(),e=$("#email").val().trim(),j=$("#password").val().trim(),d=$("#description").val().trim(),n=$("#street_number").val().trim(),m=$("#street_name").val().trim(),k=$("#postal_code").val().trim(),b=$("#city").val().trim(),l=$("#province").val().trim(),g=$("#company_logo")[0],g.files.length>0&&(f=g.files[0],i="logo.jpg",h=new Parse.File(i,f)),e&&j&&d&&n&&m&&k&&b&&l&&h&&c?(o=new Parse.User,o.set("username",e),o.set("password",j),o.set("email",e),o.set("description",d),o.set("street_number",n),o.set("street_name",m),o.set("postal_code",k),o.set("city",b),o.set("province",l),o.set("company_logo",h),o.set("company_name",c),o.signUp(null,{success:function(a){window.location.href="#dashboard"},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})):alert("Please fill in all the textboxes")},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.Dashboard=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/Dashboard.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.className="",d.prototype.events={},d.prototype.initialize=function(){var a=this;return Parse.User.current().fetch().then(function(b){var c;return console.log(b.toJSON()),a.user=Parse.User.current(),c=new Parse.Query("Deals"),c.equalTo("owner",b),c.find({success:function(b){return a.collection=_.map(b,function(a){return a.toJSON()}),a.render()}})})},d.prototype.render=function(){var a;return a=Mustache.render(this.template(),{user:this.user.toJSON(),deals:this.collection}),this.$el.html(a),_.map($(".time"),function(a){var b;return b=$(a).html(),$(a).html(moment(b).fromNow())}),_.map($(".viwedBy"),function(a){var b,c,d,e;return e=$(a).attr("data-created-at"),d=(new Date).getTime()-new Date(e).getTime(),d=parseInt(d/1e4),c=d+123,b=d/c*100,b=parseInt(b),$(a).html("<p>Reached "+c+" people</p> <p>Click rate "+b+"% ("+d+" people)</p>")})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.NewDeal=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/NewDeal.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.events={"click #create":"create"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){return this.$el.html(this.template())},d.prototype.getYoutubeIdFromURI=function(a){var b;return b=RegExp("[?&]v=([^&]*)").exec(a),b&&decodeURIComponent(b[1].replace(/\+/g," "))},d.prototype.create=function(a){var b,c,d,e,f,g,h,i,j,k,l;return a.preventDefault(),g=$("#heading").val(),f=$("#dealImage")[0],f.files.length>0&&(e=f.files[0],i="photo.jpg",h=new Parse.File(i,e)),l=$("#youtube").val().trim(),c=parseInt($("#category").val()),g&&h&&c>=0?(b=Parse.Object.extend("Deals"),d=new b,d.set("heading",g),d.set("mainImage",h),d.set("youtube_video_id",this.getYoutubeIdFromURI(l)),d.set("category",c),$("#create").html("submitting...").prop("disabled",!0),j=Parse.User.current().get("postal_code"),k="http://maps.googleapis.com/maps/api/geocode/json?address="+j,$.post(k,function(a){var b;return b=new Parse.GeoPoint({latitude:a.results[0].geometry.location.lat,longitude:a.results[0].geometry.location.lng}),d.set("location",b),d.set("owner",Parse.User.current()),d.save(null,{success:function(){var a,b;return console.log("saved"),b=g,Parse.User.current().get("company_name")&&(a=Parse.User.current().get("company_name"),b=""+g+" from "+a),Parse.Push.send({channels:["global"],data:{alert:b}},{success:function(){return console.log("Push was successful")},error:function(a){return console.error(a)}}),window.location.href="#dashboard"},error:function(a){return $("#create").html("Create").prop("disabled",!1),console.error(a),alert("error")}})})):(console.log(g,h,c),alert("Please make sure that Heading, Image, and Category are sections are set"))},d}(Backbone.View)}.call(this);