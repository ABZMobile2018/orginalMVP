(function(){window.Dash={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";return Dash.Parse=Parse,Dash.Parse.initialize("D7VKvOCpa2Pnt8lr3dvynhVQxoDW6AgiXVsyQuB1","Rs7IHkHHTTqv7O51TKwhNHMZnvQyvqrqUg5jn1pg"),new Dash.Routers.Routes}},$(function(){"use strict";return Dash.init()})}).call(this),this.JST=this.JST||{},this.JST["app/scripts/templates/Dashboard.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="container">\n\n  {{#user}}\n  <div class="row">\n    <div class="col-md-2 text-right">\n      <img src="{{company_logo.url}}" style="width:100%;">\n      <h4>{{company_name}}</h4>\n      <u><a href="#edit">Edit</a></u>\n    </div>\n    <div class="col-md-6 col-md-offset-4 text-right">\n      <p><strong>Email:</strong> {{email}}</p> \n      <p><strong>Profile:</strong> {{description}}</p>\n      <p><strong>Address:</strong> {{street_number}} {{street_name}} {{city}} {{province}} {{postal_code}}</p>\n      <p>\n        <span style="width:10px;"></span> \n        <u><a href="#logout">Logout</a></u>\n      </p>\n    </div>\n  </div>\n  {{/user}}\n\n  <hr>\n\n  <div class="row">\n    <div class="col-md-3">\n      <p>123 People Nearby</p>\n      <a class="btn btn-info" href="#newDeal">+ Add A New Deal</a>\n    </div>\n  </div>\n\n  <hr>\n\n  {{#deals}}\n    <div class="row">\n      <div class="col-md-4">\n        <img src="{{mainImage.url}}"/>\n      </div>\n      <div class="col-md-5">\n        <h1>{{heading}}</h1>\n        <p>Created <span class="time">{{createdAt}}</span></p>\n        <p class="valid-time">{{expiry.iso}}</p>\n\n        <div class="viwedBy" data-created-at="{{createdAt}}">\n          287\n        </div>\n        <p class="text-right">\n          <button class="delete btn btn-danger" data-object-id={{objectId}}>Delete</button>\n        </p>\n      </div>\n    </div>\n    <div style="height:5vh;"></div>\n  {{/deals}}\n</div>';return __p},this.JST["app/scripts/templates/EditProfile.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='{{#user}}\n<div style="height:10vh;"></div>\n<div class="container" style="height:100vh;">\n\n  <form class="form-horizontal">\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Company Name (*)</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control" id="company_name" placeholder="Company Name" value="{{company_name}}">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Company Logo (*)</label>\n      <div class="col-sm-4 col-sm-offset-3">\n        <img src="{{company_logo.url}}">\n        <input type="file" class="form-control" id="company_logo" placeholder="Company Name">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Password (*)</label>\n      <div class="col-sm-10">\n        <input type="password" class="form-control" id="password" placeholder="Password">\n      </div>\n    </div>\n    \n    <div class="form-group">\n      <label class="col-sm-2 control-label">Description (*)</label>\n      <div class="col-sm-10">\n        <textarea id="description" rows="3" style="width:100%;">{{description}}</textarea>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Address (*)</label>\n\n      <div class="col-sm-10">\n        <div class="row">\n          <div class="col-sm-2">\n            <input id="street_number" type="text" class="form-control" placeholder="Street #" value="{{street_number}}"/>\n          </div>\n          <div class="col-sm-8">\n            <input id="street_name" type="text" class="form-control" placeholder="Street Name" value="{{street_name}}"/>\n          </div>\n          <div class="col-sm-2">\n            <input id="postal_code" type="text" class="form-control" placeholder="Postal Code" value="{{postal_code}}"/>\n          </div>\n        </div>\n        <div class="row" style="margin-top:10px;">\n          <div class="col-sm-8">\n            <input id="city" type="text" class="form-control" placeholder="City" value="city"/>\n          </div>\n          <div class="col-sm-4">\n            <input id="province" type="text" class="form-control" placeholder="Province" value="{{province}}"/>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="col-sm-2 col-sm-offset-10 text-right">\n      <p>(*) are required fields</p>\n      <a id="cancel" href="#dashboard" class="btn btn-default">Cancel</a>\n        <button id="save" type="submit" class="btn btn-info">Save</button>\n      </div>\n    </div>\n\n  </form>\n</div>\n{{/user}}';return __p},this.JST["app/scripts/templates/Landing.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="landing">\n    <div class="login-form">\n        <h1>Welcome to Airbrowz</h1>\n        <p>Merchant login</p>\n        <form class="form-inline">\n          <div class="form-group">\n            <label class="sr-only" for="email">Email</label>\n            <input id="email" type="email" class="form-control" placeholder="Email">\n          </div>\n          <div class="form-group">\n            <label class="sr-only" for="password">Password</label>\n            <input id="password" type="password" class="form-control" placeholder="Password">\n          </div>\n          \n          <button id="login" type="submit" class="btn btn-primary">Sign in</button>\n\n          <p style="margin-top:10px;">\n            <a href="#signup" style="color:white;">Create a new account</a>\n          </p>\n        </form>\n    </div>\n</div>';return __p},this.JST["app/scripts/templates/NewDeal.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="container">\n\n  <a class="btn btn-default" href="#dashboard">\n    Cancel\n  </a>\n\n  <hr>\n\n  <form class="form-horizontal">\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Heading (*)</label>\n      <div class="col-sm-10">\n        <input id=\'heading\' type="text" class="form-control" placeholder="Deal Title">\n      </div>\n    </div>\n\n    <div style="height:2vh;"></div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Valid until (*)</label>\n      <div class="col-sm-5 col-sm-offset-1">\n        <div id=\'date\'></div>\n      </div>\n    </div>\n\n    <div style="height:2vh;"></div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Image (*)</label>\n      <div class="col-sm-10">\n        <input type="file" id="dealImage">\n      </div>\n    </div>\n\n    <div style="height:2vh;"></div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Youtube Link</label>\n      <div class="col-sm-10">\n        <input id="youtube" type="text" class="form-control" placeholder="Optional">\n      </div>\n    </div>\n\n    <div style="height:2vh;"></div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Category (*)</label>\n      <div class="col-sm-10">\n        <select id="category" class="form-control">\n          <option>-- Select --</option>\n          <option value="0">Maternity & Children’s wear</option>\n          <option value="1">Men’s Fashion</option>\n          <option value="2">Women’s Fashion</option>\n          ​<option value="3">Books, Music, Games & Gifts</option>\n          <option value="4">Computers, Tablets & Mobiles</option>\n          <option value="5">Handbags & Footwear</option>\n          <option value="6">Health & Beauty</option>\n          <option value="7">Fitness & Well-Being</option>\n          <option value="8">Food & Drink</option>\n          <option value="9">Electronics & Entertainment</option>\n          <option value="10">Automotive</option>\n          <option value="11">Home & Garden</option>\n          <option value="12">Services</option>\n          <option value="13">Sports, Outdoor & Travel</option>\n          <option value="14">Events</option>\n          <option value="15">Misc</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="form-group text-right">\n      <p>(*) are required fields</p>\n    </div>\n\n    <div class="form-group">\n      <div class="col-md-2 col-md-offset-10 text-right">\n        <button class="btn btn-info btn-lg" id="create">Create</button>\n      </div>\n    </div>\n\n  </form>\n</div>\n';return __p},this.JST["app/scripts/templates/Signup.html"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div style="height:10vh;"></div>\n<div class="container" style="height:100vh;">\n\n  <form class="form-horizontal">\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Company Name (*)</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control" id="company_name" placeholder="Company Name">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Company Logo (*)</label>\n      <div class="col-sm-10">\n        <input type="file" class="form-control" id="company_logo" placeholder="Company Name">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Email (*)</label>\n      <div class="col-sm-10">\n        <input type="email" class="form-control" id="email" placeholder="Email">\n      </div>\n    </div>\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Password (*)</label>\n      <div class="col-sm-10">\n        <input type="password" class="form-control" id="password" placeholder="Password">\n      </div>\n    </div>\n    \n    <div class="form-group">\n      <label class="col-sm-2 control-label">Description (*)</label>\n      <div class="col-sm-10">\n        <textarea id="description" rows="3" style="width:100%;"></textarea>\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-sm-2 control-label">Address (*)</label>\n\n      <div class="col-sm-10">\n        <div class="row">\n          <div class="col-sm-2">\n            <input id="street_number" type="text" class="form-control" placeholder="Street #" />\n          </div>\n          <div class="col-sm-8">\n            <input id="street_name" type="text" class="form-control" placeholder="Street Name" />\n          </div>\n          <div class="col-sm-2">\n            <input id="postal_code" type="text" class="form-control" placeholder="Postal Code" />\n          </div>\n        </div>\n        <div class="row" style="margin-top:10px;">\n          <div class="col-sm-8">\n            <input id="city" type="text" class="form-control" placeholder="City" />\n          </div>\n          <div class="col-sm-4">\n            <input id="province" type="text" class="form-control" placeholder="Province" />\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="form-group text-right">\n      <p>(*) are required fields</p>\n    </div>\n\n    <div class="form-group">\n      <div class="col-sm-1 col-sm-offset-11">\n        <button id="register" type="submit" class="btn btn-info">Register</button>\n      </div>\n    </div>\n\n  </form>\n</div>';return __p},function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Models.User=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.url="",d.prototype.initialize=function(){},d.prototype.defaults={},d.prototype.validate=function(a,b){},d.prototype.parse=function(a,b){return a},d}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.Landing=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/Landing.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.className="",d.prototype.events={"click #login":"login"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){return this.$el.html(this.template())},d.prototype.login=function(a){var b,c;return a.preventDefault(),console.log("login"),b=$("#email").val(),c=$("#password").val(),Parse.User.logOut(),Parse.User.logIn(b,c,{success:function(a){window.location.href="#dashboard"},error:function(a,b){alert("Wrong email/password. Please try again")}})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Routers.Routes=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.routes={"":"landing",signup:"signup",dashboard:"dashboard",newDeal:"newDeal",edit:"edit",logout:"logout"},d.prototype.initialize=function(){return Backbone.history.start()},d.prototype.landing=function(){return console.log("landing"),new Dash.Views.Landing({el:$("#main")[0]})},d.prototype.dashboard=function(){return console.log("dashboard"),Parse.User.current()?new Dash.Views.Dashboard({el:$("#main")[0]}):(console.log("need to authenticate"),window.location.href="/")},d.prototype.signup=function(){return console.log("signup"),new Dash.Views.Signup({el:$("#main")[0]})},d.prototype.newDeal=function(){return console.log("new deal"),new Dash.Views.NewDeal({el:$("#main")[0]})},d.prototype.edit=function(){return new Dash.Views.EditProfile({el:$("#main")[0]})},d.prototype.logout=function(){return Parse.User.logOut(),window.location.href="/"},d}(Backbone.Router)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.Signup=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/Signup.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.className="",d.prototype.events={"click #register":"signup"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){return Parse.User.logOut(),this.$el.html(this.template())},d.prototype.signup=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return a.preventDefault(),c=$("#company_name").val().trim(),e=$("#email").val().trim(),j=$("#password").val().trim(),d=$("#description").val().trim(),n=$("#street_number").val().trim(),m=$("#street_name").val().trim(),k=$("#postal_code").val().trim(),b=$("#city").val().trim(),l=$("#province").val().trim(),g=$("#company_logo")[0],g.files.length>0&&(f=g.files[0],i="logo.jpg",h=new Parse.File(i,f)),e&&j&&d&&n&&m&&k&&b&&l&&h&&c?(o=new Parse.User,o.set("username",e),o.set("password",j),o.set("email",e),o.set("description",d),o.set("street_number",n),o.set("street_name",m),o.set("postal_code",k),o.set("city",b),o.set("province",l),o.set("company_logo",h),o.set("company_name",c),o.signUp(null,{success:function(a){window.location.href="#dashboard"},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})):alert("Please fill in all the textboxes")},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.Dashboard=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/Dashboard.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.className="",d.prototype.events={"click .delete":"delete"},d.prototype.initialize=function(){var a=this;return Parse.User.current().fetch().then(function(b){var c;return a.user=Parse.User.current(),c=new Parse.Query("Deals"),c.equalTo("owner",b),c.find({success:function(b){return a.collection=_.map(b,function(a){return a.toJSON()}),a.render()}})})},d.prototype.render=function(){var a;return a=Mustache.render(this.template(),{user:this.user.toJSON(),deals:this.collection}),this.$el.html(a),_.map($(".time"),function(a){var b;return b=$(a).html(),$(a).html(moment(b).from(new Date))}),_.map($(".valid-time"),function(a){var b;return b=$(a).html(),b=moment(b).from(new Date),b.indexOf("ago")>-1?$(a).html("Expired "+b):$(a).html("Expires "+b)}),_.map($(".viwedBy"),function(a){var b,c,d,e;return e=$(a).attr("data-created-at"),d=(new Date).getTime()-new Date(e).getTime(),d=parseInt(d/1e4),c=d+123,b=d/c*100,b=parseInt(b),$(a).html("<p>Reached "+c+" people</p> <p>Click rate "+b+"% ("+d+" people)</p>")})},d.prototype["delete"]=function(a){var b,c,d,e,f=this;return a.preventDefault(),e=a.target,d=e.getAttribute("data-object-id"),b=Parse.Object.extend("Deals"),c=new b,c.set("objectId",d),c.destroy({success:function(){var a;return console.log("deal destroyed"),a=new Parse.Query("Deals"),a.equalTo("owner",f.user),a.find({success:function(a){return f.collection=_.map(a,function(a){return a.toJSON()}),f.render()}})},error:function(){return console.error("error")}})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.NewDeal=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/NewDeal.html"],d.prototype.tagName="div",d.prototype.id="main",d.prototype.events={"click #create":"create"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){var a;return this.$el.html(this.template()),$("#date").datetimepicker({inline:!0,sideBySide:!0,useCurrent:!0}),$("#date").data("DateTimePicker").minDate(new Date),a=new Date,a.setHours(a.getHours()+5),$("#date").data("DateTimePicker").date(a)},d.prototype.getYoutubeIdFromURI=function(a){var b;return b=RegExp("[?&]v=([^&]*)").exec(a),b&&decodeURIComponent(b[1].replace(/\+/g," "))},d.prototype.create=function(a){var b,c,d,e,f,g,h,i,j,k,l;return a.preventDefault(),$("#create").html("submitting...").prop("disabled",!0),g=$("#heading").val(),f=$("#dealImage")[0],f.files.length>0&&(e=f.files[0],i="photo.jpg",h=new Parse.File(i,e)),l=$("#youtube").val().trim(),c=parseInt($("#category").val()),g&&h&&c>=0?(b=Parse.Object.extend("Deals"),d=new b,d.set("heading",g),d.set("mainImage",h),d.set("youtube_video_id",this.getYoutubeIdFromURI(l)),d.set("category",c),d.set("expiry",$("#date").data("DateTimePicker").date()._d),j=Parse.User.current().get("postal_code"),k="http://maps.googleapis.com/maps/api/geocode/json?address="+j,$.post(k,function(a){var b;return b=new Parse.GeoPoint({latitude:a.results[0].geometry.location.lat,longitude:a.results[0].geometry.location.lng}),d.set("location",b),d.set("owner",Parse.User.current()),d.save(null,{success:function(){var a,b;return console.log("saved"),b=g,Parse.User.current().get("company_name")&&(a=Parse.User.current().get("company_name"),b=""+g+" from "+a),Parse.Push.send({channels:["global"],data:{alert:b}},{success:function(){return window.location.href="#dashboard",console.log("Push was successful")},error:function(a){return console.error(a)}})},error:function(a){return $("#create").html("Create").prop("disabled",!1),console.error(a),alert("error")}})})):(console.log(g,h,c),$("#create").html("Create").prop("disabled",!1),alert("Please make sure that Heading, Image, and Category are sections are set"))},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Dash.Views.EditProfile=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/EditProfile.html"],d.prototype.tagName="div",d.prototype.id="",d.prototype.className="",d.prototype.events={"click #save":"save"},d.prototype.initialize=function(){return this.user_model=Parse.User.current(),this.render()},d.prototype.render=function(){var a;return a=Mustache.render(this.template(),{user:this.user_model.toJSON()}),this.$el.html(a)},d.prototype.save=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this;return a.preventDefault(),c=$("#company_name").val().trim(),h=$("#password").val().trim(),d=$("#description").val().trim(),l=$("#street_number").val().trim(),k=$("#street_name").val().trim(),i=$("#postal_code").val().trim(),b=$("#city").val().trim(),j=$("#province").val().trim(),f=$("#company_logo")[0],f.files.length>0&&(e=f.files[0],g=new Parse.File("logo.jpg",e),this.user_model.set("company_logo",g)),this.user_model.set("description",d),this.user_model.set("street_number",l),this.user_model.set("street_name",k),this.user_model.set("postal_code",i),this.user_model.set("city",b),this.user_model.set("province",j),this.user_model.set("company_name",c),h?(this.user_model.set("password",h),this.user_model.save({success:function(){return console.log(m.user_model.get("email"),h),Parse.User.logOut(),Parse.User.logIn(m.user_model.get("email"),h,{success:function(a){return window.location.href="#dashboard"}})},error:function(a){}})):this.user_model.save({success:function(){return window.location.href="#dashboard"},error:function(){}})},d}(Backbone.View)}.call(this);